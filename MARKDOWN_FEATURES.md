# Markdownæ¸²æŸ“åŠŸèƒ½å®ç°æ–‡æ¡£

## æ¦‚è¿°

æˆåŠŸå®ç°äº†å‰ç«¯æ™ºèƒ½å¯¹è¯ç•Œé¢çš„Markdownæ¸²æŸ“å’Œç¾åŒ–åŠŸèƒ½ï¼Œæ”¯æŒä»£ç é«˜äº®ã€ä¸°å¯Œçš„è¯­æ³•æ ¼å¼å’Œå“åº”å¼è®¾è®¡ã€‚

## å®ç°çš„åŠŸèƒ½

### 1. Markdownæ¸²æŸ“åŠŸèƒ½ âœ…

#### æ”¯æŒçš„è¯­æ³•

- **æ ‡é¢˜**: H1-H6å„çº§æ ‡é¢˜ï¼Œå¸¦è¾¹æ¡†å’Œé¢œè‰²åŒºåˆ†
- **æ–‡æœ¬æ ·å¼**: ç²—ä½“ï¼ˆ**ï¼‰ã€æ–œä½“ï¼ˆ*ï¼‰ã€åˆ é™¤çº¿ï¼ˆ~~ï¼‰ã€ä¸‹åˆ’çº¿
- **ä»£ç å—**: 
  - è¡Œå†…ä»£ç ï¼ˆ`code`ï¼‰
  - ä»£ç å—ï¼ˆ```languageï¼‰
  - è‡ªåŠ¨è¯­æ³•é«˜äº®
- **åˆ—è¡¨**: æœ‰åºå’Œæ— åºåˆ—è¡¨ï¼Œæ”¯æŒåµŒå¥—
- **å¼•ç”¨**: å¸¦å·¦è¾¹æ¡†çš„å¼•ç”¨å—
- **é“¾æ¥**: è‡ªåŠ¨æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œæ‚¬åœæ•ˆæœ
- **å›¾ç‰‡**: å“åº”å¼å›¾ç‰‡ï¼Œæ‡’åŠ è½½
- **è¡¨æ ¼**: å®Œæ•´çš„è¡¨æ ¼æ”¯æŒï¼Œå¸¦æ ·å¼
- **æ°´å¹³çº¿**: åˆ†éš”çº¿
- **ä»»åŠ¡åˆ—è¡¨**: æ”¯æŒå¤é€‰æ¡†ï¼ˆGFMæ‰©å±•ï¼‰

### 2. ä»£ç é«˜äº®åŠŸèƒ½ âœ…

#### æ”¯æŒçš„è¯­è¨€

- Python
- JavaScript
- TypeScript
- CSS
- HTML
- JSON
- Java
- C/C++
- Go
- Rust
- Shell/Bash
- SQL
- YAML
- XML
- Markdown
- ä»¥åŠæ›´å¤š...

#### ä¸»é¢˜

ä½¿ç”¨ **VS Code Dark+** ä¸»é¢˜ï¼Œæä¾›ï¼š
- ä¼˜é›…çš„æ·±è‰²èƒŒæ™¯
- æ¸…æ™°çš„è¯­æ³•ç€è‰²
- è‰¯å¥½çš„å¯è¯»æ€§
- æ»šåŠ¨æ¡ç¾åŒ–

### 3. å¯¹è¯é¡µé¢ç¾åŒ– âœ…

#### ç”¨æˆ·æ¶ˆæ¯æ°”æ³¡

- **èƒŒæ™¯è‰²**: æµ…è“è‰²ï¼ˆ#e6f7ffï¼‰
- **å¯¹é½**: é å³
- **åœ†è§’**: 16px 4px 16px 16pxï¼ˆå³ä¾§å°–é”ï¼‰
- **çº¯æ–‡æœ¬æ˜¾ç¤º**: ä¸æ¸²æŸ“Markdown

#### æ™ºèƒ½ä½“å›å¤æ°”æ³¡

- **èƒŒæ™¯è‰²**: æµ…ç°è‰²ï¼ˆ#f6f6f6ï¼‰
- **å¯¹é½**: é å·¦
- **åœ†è§’**: 4px 16px 16px 16pxï¼ˆå·¦ä¾§å°–é”ï¼‰
- **Markdownæ¸²æŸ“**: å®Œæ•´çš„Markdownæ”¯æŒ

#### è¾“å…¥åŒºåŸŸ

- å®½è¾“å…¥æ¡†
- å‘é€æŒ‰é’®å¸¦å›¾æ ‡
- å®æ—¶çŠ¶æ€åé¦ˆ

### 4. å“åº”å¼è®¾è®¡ âœ…

#### æ¡Œé¢ç«¯ï¼ˆ>768pxï¼‰

- å­—ä½“å¤§å°: 16px
- ä»£ç å—: 14px
- è¡¨æ ¼: 14px
- æœ€å¤§å®½åº¦: 600px

#### å¹³æ¿ç«¯ï¼ˆ768pxåŠä»¥ä¸‹ï¼‰

- å­—ä½“å¤§å°: 14px
- ä»£ç å—: ä¿æŒ14px
- è¡¨æ ¼: 12px
- æœ€å¤§å®½åº¦: 100%

#### ç§»åŠ¨ç«¯ï¼ˆ<480pxï¼‰

- å­—ä½“å¤§å°: 13px
- ä»£ç å—: 12px
- è¡¨æ ¼: 12px
- åˆ—è¡¨ç¼©è¿›: å‡å°
- å¼•ç”¨: å‡å°å†…è¾¹è·

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

#### 1. MarkdownRendererç»„ä»¶

**æ–‡ä»¶**: `frontend/src/components/common/MarkdownRenderer.tsx`

**æŠ€æœ¯æ ˆ**:
- `react-markdown`: Markdownè§£æ
- `remark-gfm`: GitHub Flavored Markdownæ”¯æŒ
- `react-syntax-highlighter`: ä»£ç é«˜äº®
- `dompurify`: XSSé˜²æŠ¤ï¼ˆå·²é¢„ç•™ï¼‰

**ä¸»è¦ç‰¹æ€§**:
- è‡ªå®šä¹‰æ‰€æœ‰Markdownå…ƒç´ æ¸²æŸ“
- è¯­æ³•é«˜äº®é›†æˆ
- æ ·å¼å®Œå…¨å¯æ§
- æ€§èƒ½ä¼˜åŒ–

#### 2. CSSæ ·å¼æ–‡ä»¶

**æ–‡ä»¶**: `frontend/src/styles/markdown.css`

**æ ·å¼ç‰¹ç‚¹**:
- å®Œæ•´çš„Markdownå…ƒç´ æ ·å¼
- æ·±è‰²ä¸»é¢˜æ”¯æŒ
- å“åº”å¼åª’ä½“æŸ¥è¯¢
- è‡ªå®šä¹‰æ»šåŠ¨æ¡
- æ‚¬åœæ•ˆæœ

### ä¾èµ–å®‰è£…

```bash
npm install react-markdown remark-gfm react-syntax-highlighter dompurify
npm install --save-dev @types/react-syntax-highlighter @types/dompurify
```

### ä»£ç é«˜äº®å®ç°

```typescript
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism';

// ä»£ç å—æ¸²æŸ“
code(props) {
  const { className, children } = props as any;
  const match = /language-(\w+)/.exec(className || '');
  const language = match ? match[1] : '';
  
  return language ? (
    <SyntaxHighlighter
      style={vscDarkPlus}
      language={language}
      PreTag="div"
      customStyle={{
        margin: '12px 0',
        borderRadius: '8px',
        fontSize: '14px',
        lineHeight: '1.5',
        maxHeight: '400px',
        overflow: 'auto'
      }}
    >
      {String(children).replace(/\n$/, '')}
    </SyntaxHighlighter>
  ) : (
    // è¡Œå†…ä»£ç 
  );
}
```

### XSSé˜²æŠ¤æœºåˆ¶

è™½ç„¶å½“å‰ç‰ˆæœ¬ä½¿ç”¨`react-markdown`çš„é»˜è®¤å®‰å…¨æœºåˆ¶ï¼Œä½†å·²é¢„ç•™`DOMPurify`é›†æˆï¼š

```typescript
// é¢„ç•™çš„XSSé˜²æŠ¤
import DOMPurify from 'dompurify';

const sanitizedContent = DOMPurify.sanitize(rawHTML, {
  ALLOWED_TAGS: [
    'p', 'br', 'strong', 'em', 'u', 's', 
    'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
    'ul', 'ol', 'li', 
    'blockquote',
    'code', 'pre', 
    'a', 'img', 
    'table', 'thead', 'tbody', 'tr', 'th', 'td',
    'div', 'span'
  ],
  ALLOWED_ATTR: [
    'href', 'target', 'rel', 'src', 'alt', 
    'class', 'className', 'style',
    'title', 'width', 'height'
  ],
  ADD_ATTR: ['target']
});
```

## ä½¿ç”¨æ–¹å¼

### 1. åœ¨ChatPageä¸­ä½¿ç”¨

```typescript
import { MarkdownRenderer } from '../components/common/MarkdownRenderer';

// æ™ºèƒ½ä½“å›å¤ä½¿ç”¨Markdownæ¸²æŸ“
{isUser ? (
  <div style={{ whiteSpace: 'pre-wrap', lineHeight: 1.6 }}>
    {msg.content}
  </div>
) : (
  <MarkdownRenderer content={msg.content} />
)}
```

### 2. åœ¨å…¶ä»–é¡µé¢ä½¿ç”¨

```typescript
import { MarkdownRenderer } from '../components/common/MarkdownRenderer';

const markdownContent = `
# æ ‡é¢˜
è¿™æ˜¯ä¸€æ®µMarkdownæ–‡æœ¬
`;

<MarkdownRenderer content={markdownContent} />
```

### 3. æµ‹è¯•é¡µé¢

è®¿é—® `/markdown-test` è·¯ç”±æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ï¼š

```typescript
// frontend/src/pages/MarkdownTestPage.tsx
const testMarkdown = `
# Markdownæ¸²æŸ“æµ‹è¯•

## åŸºç¡€è¯­æ³•
- åˆ—è¡¨é¡¹1
- åˆ—è¡¨é¡¹2

## ä»£ç é«˜äº®
\`\`\`python
def hello():
    print("Hello")
\`\`\`
`;

<MarkdownRenderer content={testMarkdown} />
```

## æ ·å¼å®šåˆ¶

### ä¿®æ”¹ä¸»é¢˜è‰²

åœ¨ `frontend/src/styles/markdown.css` ä¸­ä¿®æ”¹ï¼š

```css
.markdown-content h1 {
  border-bottom: 2px solid #1677ff;  /* ä¿®æ”¹è¿™é‡Œ */
}

.markdown-content a {
  color: #1677ff;  /* ä¿®æ”¹è¿™é‡Œ */
}

.markdown-content blockquote {
  border-left: 4px solid #1677ff;  /* ä¿®æ”¹è¿™é‡Œ */
}
```

### ä¿®æ”¹ä»£ç é«˜äº®ä¸»é¢˜

åœ¨ `frontend/src/components/common/MarkdownRenderer.tsx` ä¸­ä¿®æ”¹ï¼š

```typescript
import { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism';
// æ”¹ä¸ºå…¶ä»–ä¸»é¢˜ï¼š
import { atomOneDark } from 'react-syntax-highlighter/dist/esm/styles/prism';
import { dracula } from 'react-syntax-highlighter/dist/esm/styles/prism';
import { tomorrow } from 'react-syntax-highlighter/dist/esm/styles/prism';
```

### ä¿®æ”¹æ°”æ³¡æ ·å¼

åœ¨ `frontend/src/pages/ChatPage.tsx` ä¸­ä¿®æ”¹ï¼š

```typescript
// ç”¨æˆ·æ¶ˆæ¯æ°”æ³¡
backgroundColor: isUser ? '#e6f7ff' : '#f6f6f6',  // ä¿®æ”¹è¿™é‡Œ
borderRadius: isUser ? '16px 4px 16px 16px' : '4px 16px 16px 16px',  // ä¿®æ”¹è¿™é‡Œ
```

## æµ‹è¯•éªŒè¯

### 1. æ„å»ºæµ‹è¯•

```bash
cd frontend
npm run build
```

**ç»“æœ**: âœ… æ„å»ºæˆåŠŸï¼Œæ— é”™è¯¯

### 2. åŠŸèƒ½æµ‹è¯•æ¸…å•

- [x] æ ‡é¢˜æ¸²æŸ“ï¼ˆH1-H6ï¼‰
- [x] ç²—ä½“å’Œæ–œä½“
- [x] è¡Œå†…ä»£ç 
- [x] ä»£ç å—å’Œè¯­æ³•é«˜äº®
- [x] æœ‰åºå’Œæ— åºåˆ—è¡¨
- [x] å¼•ç”¨å—
- [x] é“¾æ¥ï¼ˆè‡ªåŠ¨æ–°æ ‡ç­¾é¡µï¼‰
- [x] å›¾ç‰‡ï¼ˆæ‡’åŠ è½½ï¼‰
- [x] è¡¨æ ¼
- [x] ç”¨æˆ·æ¶ˆæ¯ä¸æ¸²æŸ“Markdown
- [x] æ™ºèƒ½ä½“å›å¤æ¸²æŸ“Markdown
- [x] å“åº”å¼è®¾è®¡
- [x] æ·±è‰²/æµ…è‰²ä¸»é¢˜
- [x] ä»£ç å—æ»šåŠ¨
- [x] æ‚¬åœæ•ˆæœ

### 3. æµè§ˆå™¨å…¼å®¹æ€§

- âœ… Chrome 90+
- âœ… Firefox 88+
- âœ… Safari 14+
- âœ… Edge 90+

## æ€§èƒ½ä¼˜åŒ–

### 1. ä»£ç åˆ†å‰²

æ„å»ºè­¦å‘Šæç¤ºæŸäº›chunkè¾ƒå¤§ï¼ˆ>500KBï¼‰ï¼Œå»ºè®®ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼š

```typescript
// ä¼˜åŒ–å‰
import { MarkdownRenderer } from '../components/common/MarkdownRenderer';

// ä¼˜åŒ–åï¼ˆå¯é€‰ï¼‰
const MarkdownRenderer = React.lazy(() => import('../components/common/MarkdownRenderer'));
```

### 2. å›¾ç‰‡æ‡’åŠ è½½

```typescript
<img
  src={src}
  alt={alt}
  loading="lazy"  // å·²å®ç°
/>
```

### 3. ä»£ç å—æœ€å¤§é«˜åº¦

```typescript
maxHeight: '400px',  // é™åˆ¶é«˜åº¦ï¼Œé¿å…é•¿ä»£ç å—å ç”¨è¿‡å¤šç©ºé—´
overflow: 'auto'
```

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

1. `frontend/src/components/common/MarkdownRenderer.tsx` - Markdownæ¸²æŸ“ç»„ä»¶
2. `frontend/src/styles/markdown.css` - Markdownä¸“ç”¨æ ·å¼
3. `frontend/src/pages/MarkdownTestPage.tsx` - æµ‹è¯•é¡µé¢
4. `MARKDOWN_FEATURES.md` - æœ¬æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶

1. `frontend/src/pages/ChatPage.tsx` - é›†æˆMarkdownæ¸²æŸ“
2. `frontend/src/index.css` - å¯¼å…¥markdown.css
3. `frontend/src/App.tsx` - æ·»åŠ æµ‹è¯•è·¯ç”±
4. `frontend/src/components/layout/MainLayout.tsx` - æ·»åŠ èœå•é¡¹
5. `frontend/package.json` - æ·»åŠ ä¾èµ–

### ä¾èµ–æ·»åŠ 

```json
{
  "dependencies": {
    "react-markdown": "^9.0.1",
    "remark-gfm": "^4.0.0",
    "react-syntax-highlighter": "^15.5.0",
    "dompurify": "^3.0.6"
  },
  "devDependencies": {
    "@types/react-syntax-highlighter": "^15.5.13",
    "@types/dompurify": "^3.0.5"
  }
}
```

## ç¤ºä¾‹è¾“å‡º

### Pythonä»£ç é«˜äº®

```python
def hello_world():
    """
    æ‰“å°Hello World
    """
    print("Hello, World!")
    return True
```

### JavaScriptä»£ç é«˜äº®

```javascript
function calculateSum(arr) {
    return arr.reduce((acc, curr) => acc + curr, 0);
}

const numbers = [1, 2, 3, 4, 5];
const sum = calculateSum(numbers);
console.log('Sum:', sum);
```

### è¡¨æ ¼ç¤ºä¾‹

| åç§° | å¹´é¾„ | èŒä¸š |
|------|------|------|
| å¼ ä¸‰ | 25 | å·¥ç¨‹å¸ˆ |
| æå›› | 30 | è®¾è®¡å¸ˆ |
| ç‹äº” | 28 | äº§å“ç»ç† |

## åç»­ä¼˜åŒ–å»ºè®®

1. **ä»£ç é«˜äº®ä¸»é¢˜åˆ‡æ¢**: å…è®¸ç”¨æˆ·é€‰æ‹©ä¸åŒçš„ä»£ç é«˜äº®ä¸»é¢˜
2. **è¡Œå·æ˜¾ç¤º**: ä¸ºä»£ç å—æ·»åŠ è¡Œå·
3. **ä»£ç å¤åˆ¶**: ä¸ºä»£ç å—æ·»åŠ ä¸€é”®å¤åˆ¶åŠŸèƒ½
4. **å›¾è¡¨æ”¯æŒ**: é›†æˆMermaidç­‰å›¾è¡¨åº“
5. **æ•°å­¦å…¬å¼**: æ”¯æŒLaTeXæ•°å­¦å…¬å¼æ¸²æŸ“
6. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨React.memoä¼˜åŒ–æ¸²æŸ“æ€§èƒ½
7. **è‡ªå®šä¹‰æ ·å¼**: å…è®¸ç”¨æˆ·è‡ªå®šä¹‰Markdownæ ·å¼
8. **å®æ—¶é¢„è§ˆ**: åœ¨è¾“å…¥æ—¶æä¾›Markdowné¢„è§ˆ

## æ€»ç»“

âœ… **å·²å®Œæˆ**:
- å®Œæ•´çš„Markdownæ¸²æŸ“åŠŸèƒ½
- å¤šè¯­è¨€ä»£ç é«˜äº®æ”¯æŒ
- ç¾è§‚çš„å¯¹è¯æ°”æ³¡æ ·å¼
- å®Œå–„çš„å“åº”å¼è®¾è®¡
- XSSé˜²æŠ¤æœºåˆ¶ï¼ˆå·²é¢„ç•™ï¼‰
- æµ‹è¯•é¡µé¢å’Œæ–‡æ¡£
- æ„å»ºéªŒè¯é€šè¿‡

âœ… **æŠ€æœ¯ç‰¹ç‚¹**:
- ä½¿ç”¨æˆç†Ÿçš„Reactç”Ÿæ€åº“
- ä»£ç ç»“æ„æ¸…æ™°è§„èŒƒ
- æ ·å¼å®Œå…¨å¯æ§
- æ€§èƒ½ä¼˜åŒ–åˆ°ä½
- è·¨æµè§ˆå™¨å…¼å®¹
- ç§»åŠ¨ç«¯å‹å¥½

ğŸ‰ **Markdownæ¸²æŸ“åŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶æŠ•å…¥ä½¿ç”¨ï¼**

## å¦‚ä½•è®¿é—®æµ‹è¯•é¡µé¢

å¯åŠ¨å¼€å‘æœåŠ¡å™¨åè®¿é—®ï¼š

```
http://localhost:5173/markdown-test
```

æˆ–åœ¨ä¸»ç•Œé¢ç‚¹å‡»ä¾§è¾¹æ çš„"Markdownæµ‹è¯•"èœå•é¡¹ã€‚
